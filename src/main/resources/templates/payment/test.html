<!DOCTYPE html>
<html lang="ko"
      layout:decorate="~{layout/layout}"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head layout:fragment="head">
  <meta charset="utf-8">
  <link rel="stylesheet" th:href="@{/css/main.css}" />
  <script src="https://js.tosspayments.com/v2/standard"></script>
</head>
<main layout:fragment="content">
  <div class="confirm-section">
    <h1 id="orderId">ì£¼ë¬¸ ë²ˆí˜¸ : 20251030120000-039204331</h1>
  </div>

  <!-- ğŸšš ë°°ì†¡ì§€ ìš”ì•½ -->
  <div class="confirm-section">
    <h2>ë°°ì†¡ì§€</h2>
    <p>ìˆ˜ì·¨ì¸ : í™ê¸¸ë™</p>
    <p>ì—°ë½ì²˜ : 010-1234-5678</p>
    <p>ì£¼ì†Œ : ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123, 3ì¸µ</p>
  </div>

  <!-- ğŸ ì ìš© ì¿ í° / í• ì¸ -->
  <div class="confirm-section">
    <h2>í• ì¸ Â· ì¿ í°</h2>
    <p>ì ìš© ì¿ í° : SPRINGSALE</p>
    <p>ì¿ í° í• ì¸ : âˆ’3,000ì›</p>
    <!-- í•„ìš”í•˜ë‹¤ë©´ í¬ì¸íŠ¸ / í”„ë¡œëª¨ì…˜ ì½”ë“œ ë“±ë„ ì—¬ê¸°ì— -->
  </div>

  <!-- ğŸ“š ì£¼ë¬¸ ìƒí’ˆ ìš”ì•½ -->
  <div class="confirm-section">
    <h2>ì£¼ë¬¸ ìƒí’ˆ</h2>
    <table class="order-table">
      <thead>
      <tr>
        <th>ìƒí’ˆëª…</th>
        <th>ìˆ˜ëŸ‰</th>
        <th>ê°€ê²©</th>
        <th>ìƒí’ˆ í• ì¸</th>
        <th>í•©ê³„</th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <td>Clean Code</td>
        <td>1</td>
        <td>25,000</td>
        <td>âˆ’5,000</td>
        <td>20,000</td>
      </tr>
      <!-- ë°˜ë³µ í–‰ ì˜ˆì‹œ -->
      </tbody>
    </table>
  </div>

  <!-- ğŸ’³ ê²°ì œ ì˜ˆì • ê¸ˆì•¡ -->
  <div class="confirm-summary">
    <h2>ê²°ì œ ìš”ì•½</h2>
    <dl>
      <dt>ìƒí’ˆ ê¸ˆì•¡</dt><dd>25,000</dd>
      <dt>ë°°ì†¡ë¹„</dt><dd>3,000</dd>
      <dt>ì¿ í° í• ì¸</dt><dd>âˆ’3,000</dd>
      <dt>ìƒí’ˆ í• ì¸</dt><dd>âˆ’5,000</dd>
      <dt class="total">ì´ ê²°ì œ ê¸ˆì•¡</dt>a<dd class="total" id="totalAmount">20,000</dd>
    </dl>
  </div>

  <!-- âœ”ï¸ ìµœì¢… ì§„í–‰ ë²„íŠ¼ -->
  <div class="confirm-action">
    <button type="button" id="payment">ê²°ì œí•˜ê¸°</button>
    <!-- ë˜ëŠ” <button type="submit">...</button> í˜•íƒœë¡œ í¼ ì „ì†¡ë„ ê°€ëŠ¥ -->
  </div>
</main>
<script>
  // í…ìŠ¤íŠ¸ ì¶œë ¥
  const rawOrder = document.getElementById(`orderId`).textContent;
  const orderId = rawOrder.split(`:`)[1].trim();

  const rawTotal = document.getElementById(`totalAmount`).textContent;
  const amount = parseInt(rawTotal.replace(/,/g, ''), 10);

  // Toss API ì—ì„œ ë°œê¸ˆí•œ í´ë¼ì´ì–¸íŠ¸ í‚¤
  const clientKey = "test_ck_GePWvyJnrKJqoleKgWLbVgLzN97E";
  // Toss API ì—ì„œ ê³ ê°ì„ ì‹ë³„í•˜ê¸°ìœ„í•´ ë¡œê·¸ì¸í•œ íšŒì›ì„ ì‹ë³„í•˜ëŠ” ê³ ìœ  ì‹ë³„ìš© ê°’
  const customerKey = generateRandomString();
  // Toss APIì˜ SDK ê°ì²´ ì´ˆê¸°í™”
  const tossPayments = TossPayments(clientKey);
  // SDK ì—ì„œ ê³ ê° ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê²°ì œ ì •ë³´ë¥¼ ìƒì„±
  const payment = tossPayments.payment({ customerKey });

  // ê²°ì œì°½ í˜¸ì¶œ

  document.getElementById(`payment`).addEventListener('click', () => {
    payment.requestPayment({
      method: `CARD`,
      amount: {
        currency: `KRW`,
        value: amount
      },
      orderId: orderId,
      orderName:  `ì¼ë£¨ì™€ ë„ì„œ ì‡¼í•‘ë¬¼`,
      successUrl: window.location.origin + `/payment/success.html`,
      failUrl: window.location.origin + `/payment/fail.html`,
    });
  });

  function generateRandomString() {
    // Base64ë¡œ ì¸ì½”ë”©ëœ ëœë¤ê°’ì„ 20ê¸€ìë§Œ ì˜ë¼ì„œ ì”ë‹ˆë‹¤
    return window.btoa(Math.random().toString()).slice(0, 20);
  }
</script>
</html>