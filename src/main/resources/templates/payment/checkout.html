<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <link rel="icon" href="https://static.toss.im/icons/png/4x/icon-toss-logo.png" />
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì¼ë£¨ì™€ ë„ì„œ ì‡¼í•‘ëª° ê²°ì œ</title>
    <!-- SDK ì¶”ê°€ -->
    <script src="https://js.tosspayments.com/v2/standard"></script>
</head>

<body>
<!-- ì£¼ë¬¸ì„œ ì˜ì—­ -->
<div class="wrapper">
    <h1>ğŸ“š ì¼ë£¨ì™€ ë„ì„œ ì‡¼í•‘ëª°</h1>

    <form id="order-form">
        <label>ê³ ê° ì´ë¦„:
            <input type="text" name="customerName" required />
        </label><br />

        <label>ê³ ê° ì´ë©”ì¼:
            <input type="email" name="customerEmail" required />
        </label><br /><br />

        <label>êµ¬ë§¤í•  ë„ì„œ:
            <select name="book" required>
                <option value="ìŠ¤í”„ë§ ë§ˆìŠ¤í„°:35000">ìŠ¤í”„ë§ ë§ˆìŠ¤í„° - 35,000ì›</option>
                <option value="ìë°”ì˜ ì •ì„:29000">ìë°”ì˜ ì •ì„ - 29,000ì›</option>
                <option value="ì´í™í‹°ë¸Œ ìë°”:40000">ì´í™í‹°ë¸Œ ìë°” - 40,000ì›</option>
            </select>
        </label><br /><br />

        <button type="submit">ê²°ì œí•˜ê¸°</button>
    </form>

<!--    <div class="box_section" style="padding: 40px 30px 50px 30px; margin-top: 30px; margin-bottom: 50px">-->
<!--        <h1>ì¼ë°˜ ê²°ì œ</h1>-->
<!--        &lt;!&ndash; ê²°ì œ UI &ndash;&gt;-->
<!--        <div id="payment-method" style="display: flex">-->
<!--            <button id="CARD" class="button2" onclick="selectPaymentMethod('CARD')">ì¹´ë“œ</button>-->
<!--            <button id="TRANSFER" class="button2" onclick="selectPaymentMethod('TRANSFER')">ê³„ì¢Œì´ì²´</button>-->
<!--            <button id="VIRTUAL_ACCOUNT" class="button2" onclick="selectPaymentMethod('VIRTUAL_ACCOUNT')">ê°€ìƒê³„ì¢Œ</button>-->
<!--            <button id="MOBILE_PHONE" class="button2" onclick="selectPaymentMethod('MOBILE_PHONE')">íœ´ëŒ€í°</button>-->
<!--            <button id="CULTURE_GIFT_CERTIFICATE" class="button2" onclick="selectPaymentMethod('CULTURE_GIFT_CERTIFICATE')">ë¬¸í™”ìƒí’ˆê¶Œ</button>-->
<!--            <button id="FOREIGN_EASY_PAY" class="button2" onclick="selectPaymentMethod('FOREIGN_EASY_PAY')">í•´ì™¸ê°„í¸ê²°ì œ</button>-->
<!--        </div>-->
<!--        &lt;!&ndash; ê²°ì œí•˜ê¸° ë²„íŠ¼ &ndash;&gt;-->
<!--        <button class="button" style="margin-top: 30px" onclick="requestPayment()">ê²°ì œí•˜ê¸°</button>-->
<!--    </div>-->

</div>
<script>
    const clientKey = "test_ck_0RnYX2w532DyJ7OkKwqMrNeyqApQ";
    const customerKey = generateRandomString();
    const tossPayments = TossPayments(clientKey);
    // ------  SDK ì´ˆê¸°í™” ------
    // TODO: clientKeyëŠ” ê°œë°œìì„¼í„°ì˜ API ê°œë³„ ì—°ë™ í‚¤ > ê²°ì œì°½ ì—°ë™ì— ì‚¬ìš©í•˜ë ¤í•  MID > í´ë¼ì´ì–¸íŠ¸ í‚¤ë¡œ ë°”ê¾¸ì„¸ìš”.
    // TODO: server.js ì˜ secretKey ë˜í•œ ê²°ì œìœ„ì ¯ ì—°ë™ í‚¤ê°€ ì•„ë‹Œ API ê°œë³„ ì—°ë™ í‚¤ì˜ ì‹œí¬ë¦¿ í‚¤ë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.
    // TODO: êµ¬ë§¤ìì˜ ê³ ìœ  ì•„ì´ë””ë¥¼ ë¶ˆëŸ¬ì™€ì„œ customerKeyë¡œ ì„¤ì •í•˜ì„¸ìš”. ì´ë©”ì¼ãƒ»ì „í™”ë²ˆí˜¸ì™€ ê°™ì´ ìœ ì¶”ê°€ ê°€ëŠ¥í•œ ê°’ì€ ì•ˆì „í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    // @docs https://docs.tosspayments.com/sdk/v2/js#í† ìŠ¤í˜ì´ë¨¼ì¸ -ì´ˆê¸°í™”
    // íšŒì› ê²°ì œ
    // @docs https://docs.tosspayments.com/sdk/v2/js#tosspaymentspayment
    const payment = tossPayments.payment({ customerKey });
    // ë¹„íšŒì› ê²°ì œ
    // const payment = tossPayments.payment({customerKey: TossPayments.ANONYMOUS});

    // ------ 'ê²°ì œí•˜ê¸°' ë²„íŠ¼ ëˆ„ë¥´ë©´ ê²°ì œì°½ ë„ìš°ê¸° ------
    // @docs https://docs.tosspayments.com/sdk/v2/js#paymentrequestpayment
    // async function requestPayment() {
    //     // ê²°ì œë¥¼ ìš”ì²­í•˜ê¸° ì „ì— orderId, amountë¥¼ ì„œë²„ì— ì €ì¥í•˜ì„¸ìš”.
    //     // ê²°ì œ ê³¼ì •ì—ì„œ ì•…ì˜ì ìœ¼ë¡œ ê²°ì œ ê¸ˆì•¡ì´ ë°”ë€ŒëŠ” ê²ƒì„ í™•ì¸í•˜ëŠ” ìš©ë„ì…ë‹ˆë‹¤.
    //     await payment.requestPayment({
    //         method: "CARD", // ì¹´ë“œ ë° ê°„í¸ê²°ì œ
    //         amount: {
    //             currency: "KRW",
    //             value: 15000,
    //         },
    //         orderId: generateRandomString(),
    //         orderName: "ìŠ¤í”„ë§ ì™„ì „ì •ë³µ",
    //         successUrl: window.location.origin + "/payment/success.html", // ê²°ì œ ìš”ì²­ì´ ì„±ê³µí•˜ë©´ ë¦¬ë‹¤ì´ë ‰íŠ¸ë˜ëŠ” URL
    //         failUrl: window.location.origin + "/fail.html", // ê²°ì œ ìš”ì²­ì´ ì‹¤íŒ¨í•˜ë©´ ë¦¬ë‹¤ì´ë ‰íŠ¸ë˜ëŠ” URL
    //         customerEmail: "customer123@gmail.com",
    //         customerName: "í™ê¸¸ë™",
    //         // ê°€ìƒê³„ì¢Œ ì•ˆë‚´, í€µê³„ì¢Œì´ì²´ íœ´ëŒ€í° ë²ˆí˜¸ ìë™ ì™„ì„±ì— ì‚¬ìš©ë˜ëŠ” ê°’ì…ë‹ˆë‹¤. í•„ìš”í•˜ë‹¤ë©´ ì£¼ì„ì„ í•´ì œí•´ ì£¼ì„¸ìš”.
    //         // customerMobilePhone: "01012341234",
    //         card: {
    //             useEscrow: false,
    //             flowMode: "DEFAULT",
    //             useCardPoint: false,
    //             useAppCardOnly: false,
    //         },
    //     });
    // }
    document.getElementById("order-form").addEventListener("submit", function (e) {
        e.preventDefault();
        const form = new FormData(e.target);

        const customerName = form.get("customerName");
        const customerEmail = form.get("customerEmail");

        const [bookName, rawAmount] = form.get("book").split(":");

        payment.requestPayment({
            method: "CARD",
            amount: {
                currency: "KRW",
                value: parseInt(rawAmount),
            },
            orderId: "order-" + new Date().getTime(),
            orderName: `ì¼ë£¨ì™€ | ${bookName}`,
            successUrl: window.location.origin + "/payment/success.html",
            failUrl: window.location.origin + "/fail.html",
            customerEmail: customerEmail,
            customerName: customerName,
            card: {
                useEscrow: false,
                flowMode: "DEFAULT",
                useCardPoint: false,
                useAppCardOnly: false,
            },
        });
    });

    function generateRandomString() {
      return window.btoa(Math.random()).slice(0, 20);
    }
</script>
</body>
</html>
